<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' https://unpkg.com;
    connect-src 'self' https://api.binance.com https://europe-central2-big-bliss-342920.cloudfunctions.net;
    style-src 'self' 'unsafe-inline';
  ">
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff;
      padding: 20px;
      margin: 0;
    }

    .chart-wrapper {
      max-width: 1200px;
      margin: 0 auto;
    }

    #chart {
      width: 100%;
      height: 600px;
      background: #f0f0f0;
    }
  </style>
  <title>ETH Strategy Chart</title>
</head>
<body>

  <div class="chart-wrapper">
    <div id="chart"></div>
  </div>

  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>

  <!-- Ładowanie odpowiedniego modułu strategii -->
  <script type="module">
    import { strategyMeta, getData, getMarkers } from './strategies/Strategy-1B.js';

    const chartContainer = document.getElementById('chart');

    const chart = LightweightCharts.createChart(chartContainer, {
      width: chartContainer.clientWidth,
      height: 600,
      layout: {
        background: { color: '#f0f0f0' },
        textColor: 'black',
      },
      grid: {
        vertLines: { color: '#e0e0e0' },
        horzLines: { color: '#e0e0e0' },
      },
    });

    const candleSeries = chart.addCandlestickSeries();

    async function loadChart() {
      try {
        const candles = await getData();

        if (!Array.isArray(candles) || candles.length === 0) {
          console.error('⛔ Brak danych świec:', candles);
          return;
        }

        candleSeries.setData(candles);

        const markers = await getMarkers(candles);
        if (Array.isArray(markers)) {
          candleSeries.setMarkers(markers);
        } else {
          console.warn('⚠️ Brak markerów do ustawienia.');
        }

        console.log(`✅ Strategia ${strategyMeta.name} załadowana`);
      } catch (err) {
        console.error('❌ Błąd ładowania wykresu:', err);
      }
    }

    loadChart();
  </script>
</body>
</html>
